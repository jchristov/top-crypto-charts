<!DOCTYPE html>
<html>
    <head>
        <title>Charts</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
        <script>

            function getCharts() {

                var url = "/link?";
                
                var topCountParam = "count=".concat($("#iCount").val());
                var baseCoinParam = "&coin=".concat($("#sBase").val());
                var typeParam = "&type=".concat($("#sType").val());
                var sortParam = "&sort=".concat($("#isort").val());

                url = url.concat(topCountParam, baseCoinParam, typeParam, sortParam);       
                
                $.getJSON(url, function( data ) {
                    $("#mcc").html(data["mcc"]);
                    $("#tv").html(data["tv"]);
                })
            }

            function openMCC() {
                window.open($("#mcc").text(), '_blank');
            }

            function downloadTV() {
                
                var filename = "watchlist.txt"
                var text = $("#tv").text();

                var element = document.createElement('a');
                element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
                element.setAttribute('download', filename);

                element.style.display = 'none';
                document.body.appendChild(element);

                element.click();

                document.body.removeChild(element);
            }

            function copyToClipboard(element) {
                var $temp = $("<input>");
                $("body").append($temp);
                $temp.val($(element).text()).select();
                document.execCommand("copy");
                $temp.remove();
            }

            $(document).ready(function(){

                getCharts();

                $("#bSubmit").click(getCharts);

                $('input[type="checkbox"]').change(function(){
                    this.value = (Number(this.checked));
                });
            });
        </script>
    </head>
    <body>

        <h1>Binance Charts Generator</h1>
        <div>
            <input id="iCount" type="number" value="10" pattern="[0-9]" autocomplete="off"/>
            <label for="iCount">Number of coins</label>
        </div>
        <div>
            <select id="sBase">
                <option value="BNB">BNB</option>
                <option selected="selected" value="BTC">BTC</option>
                <option value="ETH">ETH</option>
                <option value="USDT">USDT</option>
              </select>
              <label for="sBase">Base Coin</label>
        </div>
        <div>
            <select id="sType">
                <option value="V">Top Volume</option>
                <option value="G">Top Gainers</option>
            </select>
        </div>
        <div>
            <input id="isort" type="checkbox" name="sort" value="0">
            <label for="isort">Sort Symbols Alphabetically?</label>
        </div>
        <div>
            <button id="bSubmit" type="button">Get Charts</button>
        </div>
        

        <div>
            <h2 id="hMCC">MCC</h2>
            <p id="mcc"></p>
            <button id="bCopyMCC" type="button" onClick="copyToClipboard('#mcc')">Copy</button>
            <button id="bOpenMCC" type="button" onClick="openMCC()">Open</button>
        </div>
        <br />

        <div>
            <h2 id="h1TV">Trading View</h2>
            <p id="tv"></p>
            <button id="bCopyTV" type="button" onClick="copyToClipboard('#tv')">Copy</button>
            <button id="bDownloadTV" type="button" onClick="downloadTV()">Download</button>
        </div>
        <br />

    </body>
</html>
